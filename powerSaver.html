<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart AI Power Saver â€“ Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-alt: #0b1020;
      --card: #111827;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-strong: rgba(34, 197, 94, 0.9);
      --accent-warn: #f97316;
      --accent-danger: #ef4444;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --shadow: 0 22px 45px rgba(0, 0, 0, 0.6);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 40%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(135deg, #020617 0, #020617 35%, #0b1120 100%);
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow);
      padding: 20px 22px 18px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
        padding: 16px;
      }
    }

    .app-left,
    .app-right {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-badge {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .title-badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #bbf7d0 0, #22c55e 40%, #166534 100%);
      box-shadow: 0 0 12px rgba(74, 222, 128, 0.7);
    }

    .subtitle {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .chip-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      font-size: 0.68rem;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.35);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.18), transparent);
    }

    .chip-eco {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
      background: radial-gradient(circle at top, rgba(34, 197, 94, 0.25), transparent);
    }

    .chip-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: currentColor;
      opacity: 0.8;
    }

    .mode-toggle-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .mode-label {
      font-size: 0.75rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .mode-toggle {
      display: inline-flex;
      background: rgba(15, 23, 42, 0.95);
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 3px;
      position: relative;
    }

    .mode-option {
      position: relative;
      z-index: 1;
      padding: 4px 10px;
      font-size: 0.7rem;
      border-radius: 999px;
      cursor: pointer;
      color: var(--muted);
      transition: color 0.16s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      min-width: 72px;
      justify-content: center;
      user-select: none;
    }

    .mode-option span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.7);
    }

    .mode-option.active span.dot {
      background: #dcfce7;
    }

    .mode-option.active {
      color: #e5fbe8;
    }

    .mode-highlight {
      position: absolute;
      z-index: 0;
      top: 3px;
      bottom: 3px;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(34, 197, 94, 0.3), rgba(21, 128, 61, 0.9));
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.8);
      transition: transform 0.18s ease, width 0.18s ease;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15, 118, 110, 0.12), transparent 60%),
        linear-gradient(135deg, #020617, #020617);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 12px 13px 12px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.85);
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 0.8rem;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #a3e635);
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
    }

    .card-subtitle {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .pill {
      font-size: 0.7rem;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-eco {
      background: rgba(22, 163, 74, 0.12);
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: currentColor;
    }

    .input-area {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
    }

    .input-row {
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .textarea {
      flex: 1;
      border-radius: var(--radius-md);
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.18), transparent),
        rgba(15, 23, 42, 0.98);
      color: var(--text);
      resize: vertical;
      min-height: 110px;
      max-height: 260px;
      padding: 10px 12px;
      font-size: 0.85rem;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .textarea::placeholder {
      color: #6b7280;
    }

    .small-input-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }

    .small-input-row-left {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .preset-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .preset-button {
      font-size: 0.7rem;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 1);
      color: var(--muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.08s ease;
    }

    .preset-button.active {
      background: rgba(22, 163, 74, 0.25);
      border-color: rgba(34, 197, 94, 0.85);
      color: #bbf7d0;
    }

    .preset-button:hover {
      border-color: rgba(148, 163, 184, 0.75);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 1), rgba(15, 23, 42, 0.95));
      transform: translateY(-0.5px);
    }

    .ai-usage-select {
      font-size: 0.7rem;
      padding: 5px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.98);
      color: var(--muted);
      outline: none;
    }

    .primary-button {
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      border-radius: var(--radius-pill);
      padding: 7px 16px;
      font-size: 0.8rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 12px 25px rgba(34, 197, 94, 0.4);
      transition: transform 0.09s ease, box-shadow 0.09s ease, filter 0.1s ease;
      white-space: nowrap;
    }

    .primary-button span.icon {
      display: inline-flex;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #bbf7d0 0, #16a34a 45%, #052e16 100%);
      box-shadow: 0 0 9px rgba(34, 197, 94, 0.8);
    }

    .primary-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(34, 197, 94, 0.5);
      filter: brightness(1.03);
    }

    .primary-button:active {
      transform: translateY(0);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
      filter: brightness(0.98);
    }

    .output-card {
      margin-top: 4px;
      border-radius: var(--radius-md);
      background: radial-gradient(circle at top, rgba(22, 163, 74, 0.12), transparent),
        rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 8px 9px 10px;
      font-size: 0.8rem;
      max-height: 244px;
      overflow: auto;
    }

    .output-row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
      align-items: flex-start;
    }

    .output-label {
      font-size: 0.7rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      min-width: 68px;
    }

    .output-content {
      flex: 1;
      color: #e5e7eb;
    }

    .output-content strong {
      font-weight: 500;
      color: #bbf7d0;
    }

    .output-small {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .output-ai {
      margin-top: 6px;
      padding: 7px 8px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(75, 85, 99, 0.9);
      font-size: 0.78rem;
    }

    .badge-inline {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-right: 4px;
    }

    .badge-inline-eco {
      border-color: rgba(34, 197, 94, 0.85);
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.15);
    }

    .badge-inline-warn {
      border-color: rgba(249, 115, 22, 0.85);
      color: #fed7aa;
      background: rgba(154, 52, 18, 0.35);
    }

    .badge-inline-perf {
      border-color: rgba(59, 130, 246, 0.9);
      color: #bfdbfe;
      background: rgba(30, 64, 175, 0.4);
    }

    .badge-inline-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: currentColor;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 900px) {
      .metrics-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .metric-card {
      background: linear-gradient(145deg, #020617, #020617);
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      padding: 10px 11px 11px;
      position: relative;
      overflow: hidden;
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .metric-title {
      font-size: 0.72rem;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.13em;
    }

    .metric-value {
      font-size: 1.05rem;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .metric-unit {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .metric-footnote {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .progress-bar {
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
      margin-top: 6px;
      position: relative;
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .progress-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #a3e635);
      transition: width 0.16s ease;
    }

    .progress-fill-warn {
      background: linear-gradient(90deg, #f97316, #facc15);
    }

    .progress-fill-danger {
      background: linear-gradient(90deg, #ef4444, #f97316);
    }

    .timeline {
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: rgba(15, 23, 42, 0.98);
      padding: 7px 8px 6px;
      max-height: 128px;
      overflow: auto;
      font-size: 0.76rem;
    }

    .timeline-item {
      display: flex;
      gap: 7px;
      margin-bottom: 5px;
      align-items: flex-start;
    }

    .timeline-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      margin-top: 4px;
      flex-shrink: 0;
    }

    .timeline-dot-eco {
      background: radial-gradient(circle at 30% 30%, #bbf7d0 0, #22c55e 50%, #166534 100%);
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.7);
    }

    .timeline-dot-cache {
      background: radial-gradient(circle at 30% 30%, #a5b4fc 0, #4f46e5 50%, #1d2a8a 100%);
      box-shadow: 0 0 8px rgba(129, 140, 248, 0.8);
    }

    .timeline-dot-sched {
      background: radial-gradient(circle at 30% 30%, #facc15 0, #f97316 50%, #b91c1c 100%);
      box-shadow: 0 0 8px rgba(251, 191, 36, 0.9);
    }

    .timeline-text-main {
      color: #e5e7eb;
    }

    .timeline-text-meta {
      color: #9ca3af;
      margin-top: 2px;
      font-size: 0.7rem;
    }

    .hint {
      margin-top: 6px;
      font-size: 0.7rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hint-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.6rem;
      color: #9ca3af;
    }

    .energy-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 3px;
    }

    .energy-tag {
      font-size: 0.68rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .energy-tag strong {
      font-weight: 500;
      color: #e5e7eb;
    }

    .energy-tag-eco {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
    }

    .energy-tag-eco strong {
      color: #dcfce7;
    }

    .energy-tag span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: currentColor;
    }

    .schedule-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
      color: var(--muted);
      cursor: pointer;
      user-select: none;
    }

    .schedule-toggle input {
      appearance: none;
      width: 26px;
      height: 14px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.95);
      border: 1px solid rgba(55, 65, 81, 0.95);
      position: relative;
      cursor: pointer;
      outline: none;
      transition: background 0.14s ease, border-color 0.14s ease;
    }

    .schedule-toggle input::before {
      content: "";
      position: absolute;
      top: 1px;
      left: 2px;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #9ca3af;
      transition: transform 0.14s ease, background 0.14s ease;
      box-shadow: 0 0 6px rgba(148, 163, 184, 0.8);
    }

    .schedule-toggle input:checked {
      background: rgba(22, 163, 74, 0.2);
      border-color: rgba(34, 197, 94, 0.8);
    }

    .schedule-toggle input:checked::before {
      transform: translateX(11px);
      background: #bbf7d0;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.8);
    }

    .footer-note {
      margin-top: 6px;
      font-size: 0.7rem;
      color: #6b7280;
      text-align: right;
    }
  </style>

  <!-- Update Notification System Meta Information -->
  <meta name="git-commit-hash" content="d293e5f">
  <meta name="git-commit-date" content="2026-01-06T04:08:39-05:00">
  <meta name="git-commit-author" content="Ryan Barbrick">
  <meta name="git-commit-message" content="Merge pull request #254 from barbrickdesign/copilot/fix-security-popup-api-key-implementation">

  <!-- Update Notification System -->
  <script src="js/update-notification-system.js"></script>
  <script src="js/update-helper.js"></script>
  <!-- Anti-Nuclear Safety System Active -->
  <script src="/anti-nuke-safety.js"></script>
    <style>
        .aul-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 9999;
            font-weight: 600;
        }
        .aul-badge:hover {
            background: rgba(255, 215, 0, 0.2);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
            transform: scale(1.05);
        }
    </style>
    <link rel="stylesheet" href="/css/universal-styles.css">
</head>
<body>
  <div class="app">
    <div class="app-left">
      <div class="header">
        <div class="title-block">
          <div class="title">
            âš¡ Smart AI Power Saver
            <span class="title-badge">
              <span class="title-badge-dot"></span>
              LIVE DEMO Â· LOCAL ORCHESTRATION
            </span>
          </div>
          <div class="subtitle">
            A lightweight layer that classifies tasks, optimizes compute, and simulates energy savings for AI usage.
          </div>
          <div class="chip-row">
            <span class="chip chip-eco">
              <span class="chip-dot"></span>
              Ecoâ€‘aware reasoning
            </span>
            <span class="chip">
              <span class="chip-dot"></span>
              Caching & scheduling
            </span>
            <span class="chip">
              <span class="chip-dot"></span>
              Userâ€‘controllable modes
            </span>
          </div>
        </div>
        <div class="mode-toggle-container">
          <span class="mode-label">Mode</span>
          <div class="mode-toggle" id="modeToggle">
            <div class="mode-highlight" id="modeHighlight"></div>
            <div class="mode-option active" data-mode="eco">
              <span class="dot"></span> Eco
            </div>
            <div class="mode-option" data-mode="balanced">
              <span class="dot"></span> Balanced
            </div>
            <div class="mode-option" data-mode="performance">
              <span class="dot"></span> Performance
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-dot"></span>
              AI request orchestrator
            </div>
            <div class="card-subtitle">
              Type a prompt and the orchestrator will classify it, pick a mode, and simulate energy usage.
            </div>
          </div>
          <div class="pill pill-eco">
            <span class="pill-dot"></span>
            Eco heuristics on
          </div>
        </div>

        <div class="input-area">
          <div class="input-row">
            <textarea
              id="promptInput"
              class="textarea"
              placeholder="Example: â€œExplain quantum computing to a 10â€‘yearâ€‘old in 5 bullet pointsâ€ or â€œGenerate a 1500â€‘word market analysis for renewable energy ETFs.â€"
            ></textarea>
          </div>
          <div class="small-input-row">
            <div class="small-input-row-left">
              <div class="preset-buttons">
                <button class="preset-button" data-preset="simple">
                  <span class="chip-dot"></span>
                  Simple Q&A
                </button>
                <button class="preset-button" data-preset="summarize">
                  <span class="chip-dot"></span>
                  Summarize article
                </button>
                <button class="preset-button" data-preset="long">
                  <span class="chip-dot"></span>
                  Long analysis
                </button>
                <button class="preset-button" data-preset="creative">
                  <span class="chip-dot"></span>
                  Creative story
                </button>
              </div>
              <label class="schedule-toggle">
                <input type="checkbox" id="scheduleToggle" />
                Schedule heavy tasks (offâ€‘peak)
              </label>
            </div>
            <select id="aiUsageSelect" class="ai-usage-select" title="Simulated AI context">
              <option value="chat">Chat assistant</option>
              <option value="code">Code generation</option>
              <option value="analysis">Data/market analysis</option>
              <option value="batch">Batch content generation</option>
            </select>
          </div>

          <div style="display:flex;justify-content:flex-end;margin-top:6px;gap:8px;">
            <button class="primary-button" id="runButton">
              <span class="icon"></span>
              Run through power saver
            </button>
          </div>
        </div>

        <div class="output-card" id="outputCard" style="display:none;">
          <div class="output-row">
            <div class="output-label">Classifier</div>
            <div class="output-content" id="classificationText"></div>
          </div>
          <div class="output-row">
            <div class="output-label">Decision</div>
            <div class="output-content" id="decisionText"></div>
          </div>
          <div class="output-row">
            <div class="output-label">Savings</div>
            <div class="output-content" id="savingsText"></div>
          </div>
          <div class="output-ai" id="aiSimulation">
            <span class="badge-inline badge-inline-eco" id="aiModeBadge">
              <span class="badge-inline-dot"></span>
              ECO
            </span>
            <strong>Simulated AI response summary:</strong>
            <div id="aiSummaryText" style="margin-top:2px;"></div>
          </div>
          <div class="hint">
            <span class="hint-icon">i</span>
            This is a local demo: it doesnâ€™t call any real AI or measure actual watts, but mirrors the orchestration logic.
          </div>
        </div>
      </div>
    </div>

    <div class="app-right">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-dot"></span>
              Energy dashboard
            </div>
            <div class="card-subtitle">
              Simulated metrics for how the orchestrator is reducing unnecessary compute.
            </div>
          </div>
          <div class="pill">
            <span class="pill-dot"></span>
            Session metrics
          </div>
        </div>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-title">Estimated energy saved</div>
              <span class="badge-inline badge-inline-eco">
                <span class="badge-inline-dot"></span>
                Simulated
              </span>
            </div>
            <div class="metric-value">
              <span id="energySavedValue">0.0</span>
              <span class="metric-unit">Wh</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="energySavedBar" style="width:0%;"></div>
            </div>
            <div class="metric-footnote">
              Accumulates each time you run a prompt through Eco/Balanced optimizations.
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-title">Eco utilization</div>
              <span class="badge-inline">
                <span class="badge-inline-dot"></span>
                Mode mix
              </span>
            </div>
            <div class="metric-value">
              <span id="ecoPercentValue">0</span>
              <span class="metric-unit">%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="ecoPercentBar" style="width:0%;"></div>
            </div>
            <div class="metric-footnote">
              Percentage of requests the orchestrator kept in ecoâ€‘aware paths.
            </div>
          </div>
        </div>

        <div class="timeline" id="timeline">
          <!-- Timeline items appended here -->
        </div>

        <div class="energy-tag-row">
          <div class="energy-tag energy-tag-eco" id="ecoHintTag">
            <span class="dot"></span>
            <strong>Hint:</strong> Short prompts and summaries are usually safe in Eco mode.
          </div>
          <div class="energy-tag" id="heavyHintTag">
            <span class="dot"></span>
            <strong>Heavy:</strong> Long creative or analytical tasks may be scheduled or compressed.
          </div>
        </div>

        <div class="footer-note">
          This HTML file contains all logic locally; plug in real models + telemetry to productionize it.
        </div>
      </div>
    </div>
  </div>

  <!-- Powerline Communication Tab -->
  <div class="app" id="plcApp" style="display: none; margin-top: 20px;">
    <div class="app-left">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-dot"></span>
              Powerline Communication Network
            </div>
            <div class="card-subtitle">
              Real-time monitoring and control via power cable infrastructure
            </div>
          </div>
          <div class="pill pill-eco">
            <span class="pill-dot"></span>
            <span id="plcStatus">Initializing...</span>
          </div>
        </div>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-title">Connected Devices</div>
            </div>
            <div class="metric-value">
              <span id="plcDeviceCount">0</span>
              <span class="metric-unit">devices</span>
            </div>
            <div class="metric-footnote">
              Devices discovered on power grid network
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-title">Network Health</div>
            </div>
            <div class="metric-value">
              <span id="plcSignalStrength">0</span>
              <span class="metric-unit">%</span>
            </div>
            <div class="metric-footnote">
              Average signal strength across network
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-title">Total Power</div>
            </div>
            <div class="metric-value">
              <span id="plcTotalPower">0</span>
              <span class="metric-unit">W</span>
            </div>
            <div class="metric-footnote">
              Combined power consumption of monitored devices
            </div>
          </div>
        </div>

        <div id="plcDeviceList" class="timeline">
          <!-- Device list will be populated here -->
        </div>
      </div>
    </div>

    <div class="app-right">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-dot"></span>
              Device Control
            </div>
            <div class="card-subtitle">
              Send remote commands to devices on power grid
            </div>
          </div>
        </div>

        <div class="input-area">
          <select id="plcDeviceSelect" class="ai-usage-select" style="width: 100%; margin-bottom: 12px;">
            <option value="">Select a device...</option>
          </select>

          <select id="plcCommandSelect" class="ai-usage-select" style="width: 100%; margin-bottom: 12px;">
            <option value="">Select a command...</option>
            <option value="power-on">Power On</option>
            <option value="power-off">Power Off</option>
            <option value="get-status">Get Status</option>
            <option value="reboot">Reboot Device</option>
            <option value="set-brightness">Set Brightness</option>
          </select>

          <div id="plcCommandParams" style="display: none; margin-bottom: 12px;">
            <input type="number" id="plcParamValue" class="textarea" placeholder="Parameter value..." 
                   style="height: 40px; padding: 8px 12px;" min="0" max="100" />
          </div>

          <button class="primary-button" id="plcSendCommand" disabled>
            <span class="icon"></span>
            Send Command
          </button>
        </div>

        <div id="plcCommandResult" class="output-card" style="display:none; margin-top: 12px;">
          <div class="output-row">
            <div class="output-label">Result</div>
            <div class="output-content" id="plcResultText"></div>
          </div>
        </div>

        <div class="card" style="margin-top: 12px; padding: 12px;">
          <div class="card-title" style="font-size: 0.9rem; margin-bottom: 8px;">
            <span class="card-title-dot"></span>
            Command History
          </div>
          <div id="plcCommandHistory" class="timeline" style="max-height: 200px; overflow-y: auto;">
            <!-- Command history will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toggle between Power Saver and PLC views -->
  <div style="max-width: 1100px; margin: 0 auto 20px; display: flex; gap: 10px;">
    <button class="preset-button active" id="togglePowerSaver" style="flex: 1;">
      âš¡ Power Saver Mode
    </button>
    <button class="preset-button" id="togglePLC" style="flex: 1;">
      ðŸ”Œ Powerline Communication
    </button>
  </div>

  <script>
    // State
    const state = {
      currentMode: "eco", // eco | balanced | performance
      totalEnergySavedWh: 0,
      totalRequests: 0,
      ecoRequests: 0,
      timelineItems: []
    };

    // DOM refs
    const modeToggle = document.getElementById("modeToggle");
    const modeHighlight = document.getElementById("modeHighlight");
    const modeOptions = Array.from(modeToggle.querySelectorAll(".mode-option"));

    const promptInput = document.getElementById("promptInput");
    const aiUsageSelect = document.getElementById("aiUsageSelect");
    const scheduleToggle = document.getElementById("scheduleToggle");
    const runButton = document.getElementById("runButton");
    const presetButtons = Array.from(document.querySelectorAll(".preset-button"));

    const outputCard = document.getElementById("outputCard");
    const classificationText = document.getElementById("classificationText");
    const decisionText = document.getElementById("decisionText");
    const savingsText = document.getElementById("savingsText");
    const aiModeBadge = document.getElementById("aiModeBadge");
    const aiSummaryText = document.getElementById("aiSummaryText");

    const energySavedValue = document.getElementById("energySavedValue");
    const energySavedBar = document.getElementById("energySavedBar");
    const ecoPercentValue = document.getElementById("ecoPercentValue");
    const ecoPercentBar = document.getElementById("ecoPercentBar");
    const timeline = document.getElementById("timeline");
    const ecoHintTag = document.getElementById("ecoHintTag");
    const heavyHintTag = document.getElementById("heavyHintTag");

    // Initialize mode highlight positioning
    function initModeHighlight() {
      const active = modeToggle.querySelector(".mode-option.active");
      if (!active) return;
      const rect = active.getBoundingClientRect();
      const parentRect = modeToggle.getBoundingClientRect();
      modeHighlight.style.width = rect.width + "px";
      modeHighlight.style.transform = `translateX(${rect.left - parentRect.left}px)`;
    }

    window.addEventListener("resize", initModeHighlight);
    window.addEventListener("load", initModeHighlight);

    // Mode switching
    modeOptions.forEach((opt) => {
      opt.addEventListener("click", () => {
        modeOptions.forEach((o) => o.classList.remove("active"));
        opt.classList.add("active");
        state.currentMode = opt.dataset.mode;
        const rect = opt.getBoundingClientRect();
        const parentRect = modeToggle.getBoundingClientRect();
        modeHighlight.style.width = rect.width + "px";
        modeHighlight.style.transform = `translateX(${rect.left - parentRect.left}px)`;

        updateHintsForMode();
      });
    });

    function updateHintsForMode() {
      if (state.currentMode === "eco") {
        ecoHintTag.querySelector("strong").textContent = "Hint:";
        ecoHintTag.lastChild.textContent =
          " Short prompts and summaries are usually safe in Eco mode.";
        heavyHintTag.querySelector("strong").textContent = "Heavy:";
        heavyHintTag.lastChild.textContent =
          " Long creative tasks may be scheduled or compressed.";
      } else if (state.currentMode === "balanced") {
        ecoHintTag.querySelector("strong").textContent = "Hint:";
        ecoHintTag.lastChild.textContent =
          " Balanced mode mixes efficiency with quality; you can still save with clear prompts.";
        heavyHintTag.querySelector("strong").textContent = "Tip:";
        heavyHintTag.lastChild.textContent =
          " Flag truly heavy jobs for scheduling or batching.";
      } else {
        ecoHintTag.querySelector("strong").textContent = "Note:";
        ecoHintTag.lastChild.textContent =
          " Performance mode prioritizes quality; expect less energy savings.";
        heavyHintTag.querySelector("strong").textContent = "Suggestion:";
        heavyHintTag.lastChild.textContent =
          " Keep this mode for niche, highâ€‘value tasks only.";
      }
    }

    // Preset prompts
    const presetText = {
      simple: "What is the capital of Japan?",
      summarize:
        "Summarize the key ideas from this article about remote work productivity in under 120 words.",
      long: "Write a detailed, 1500â€‘word analysis of the impact of renewable energy on global markets over the next decade.",
      creative:
        "Write a short sciâ€‘fi story about a city powered entirely by small, cooperative AI agents who optimize energy use."
    };

    presetButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const key = btn.dataset.preset;
        promptInput.value = presetText[key] || "";
        promptInput.focus();
      });
    });

    // Simple heuristic classifier: size, complexity, keywords
    function classifyPrompt(prompt, usage) {
      const raw = prompt.trim();
      const length = raw.length;
      const wordCount = raw.split(/\s+/).filter(Boolean).length;
      const lower = raw.toLowerCase();

      let complexity = "simple";
      let reason = [];

      if (wordCount > 220 || /long|detailed|comprehensive|1500|essay|report|analysis/.test(lower)) {
        complexity = "heavy";
        reason.push("long or explicitly requests detailed output");
      } else if (
        wordCount > 60 ||
        /compare|evaluate|market|data|research|simulate|architecture|pipeline|system/.test(lower)
      ) {
        complexity = "medium";
        reason.push("moderate length and/or analytical language");
      } else if (wordCount < 20 && /who|what|where|when|why|how/.test(lower)) {
        complexity = "simple";
        reason.push("short natural language question");
      } else {
        reason.push("defaulted based on general-purpose request");
      }

      // Bias by usage type
      if (usage === "analysis" || usage === "batch") {
        if (complexity === "simple") complexity = "medium";
        reason.push("usage type leans toward heavier processing");
      }

      // Est. base energy usage per request (arbitrary demo numbers)
      let baseWh;
      if (complexity === "simple") baseWh = 0.02;
      else if (complexity === "medium") baseWh = 0.09;
      else baseWh = 0.18;

      const classificationText = `Detected as a <strong>${complexity.toUpperCase()}</strong> task based on ${reason.join(
        " and "
      )}.`;

      return {
        complexity,
        baseWh,
        raw,
        wordCount,
        explanation: classificationText
      };
    }

    // Decision engine based on mode + classifier
    function decideExecution(classification, mode, scheduleEnabled) {
      const { complexity, baseWh, raw, wordCount } = classification;

      // Simulated cache check: if prompt seen before
      const cacheKey = raw.toLowerCase().replace(/\s+/g, " ").slice(0, 120);
      const cached =
        state.timelineItems.find((item) => item.cacheKey === cacheKey && item.type === "request") &&
        complexity !== "heavy";

      if (cached) {
        const savedWh = baseWh * 0.9; // assume nearly all energy avoided
        return {
          finalMode: "eco",
          reason: "Served from cache; only light local work performed.",
          action: "cache-hit",
          scheduled: false,
          expectedWh: baseWh * 0.1,
          energySavedWh: savedWh,
          cacheHit: true
        };
      }

      // Non-cached path: adjust by mode
      let finalMode = mode;
      let scheduled = false;
      let expectedWh = baseWh;
      let energySavedWh = 0;
      let reason = [];

      if (mode === "eco") {
        if (complexity === "simple") {
          // Lower-precision, short answer
          expectedWh = baseWh * 0.4;
          energySavedWh = baseWh - expectedWh;
          finalMode = "eco";
          reason.push("Eco mode truncated reasoning and length for a simple task.");
        } else if (complexity === "medium") {
          expectedWh = baseWh * 0.65;
          energySavedWh = baseWh - expectedWh;
          finalMode = "eco";
          reason.push("Eco mode compressed the request and output length.");
        } else {
          if (scheduleEnabled) {
            expectedWh = baseWh * 0.6;
            energySavedWh = baseWh * 0.4;
            finalMode = "balanced";
            scheduled = true;
            reason.push(
              "Heavy task scheduled into a batched window with compressed output in Balanced mode."
            );
          } else {
            expectedWh = baseWh * 0.8;
            energySavedWh = baseWh * 0.2;
            finalMode = "balanced";
            reason.push(
              "Heavy task forced through with moderate compression (Balanced mode) to avoid blocking."
            );
          }
        }
      } else if (mode === "balanced") {
        if (complexity === "simple") {
          expectedWh = baseWh * 0.75;
          energySavedWh = baseWh * 0.25;
          finalMode = "eco";
          reason.push("Simple task demoted to Eco inside Balanced profile.");
        } else if (complexity === "medium") {
          expectedWh = baseWh;
          energySavedWh = baseWh * 0.05;
          finalMode = "balanced";
          reason.push("Medium task run as-is with only light optimizations.");
        } else {
          if (scheduleEnabled) {
            expectedWh = baseWh * 0.7;
            energySavedWh = baseWh * 0.3;
            finalMode = "balanced";
            scheduled = true;
            reason.push(
              "Heavy task delayed/scheduled to off-peak with partial compression."
            );
          } else {
            expectedWh = baseWh * 1.05;
            energySavedWh = baseWh * -0.05;
            finalMode = "performance";
            reason.push(
              "Heavy task escalated to Performance mode to prioritize quality over savings."
            );
          }
        }
      } else {
        // performance
        if (complexity === "simple") {
          expectedWh = baseWh * 0.8;
          energySavedWh = baseWh * 0.2;
          finalMode = "eco";
          reason.push("Simple task still handled efficiently despite Performance preference.");
        } else if (complexity === "medium") {
          expectedWh = baseWh * 1.1;
          energySavedWh = baseWh * -0.1;
          finalMode = "performance";
          reason.push(
            "Medium task kept in Performance mode with richer reasoning and longer output."
          );
        } else {
          expectedWh = baseWh * 1.3;
          energySavedWh = baseWh * -0.3;
          finalMode = "performance";
          reason.push("Heavy task run fully in Performance mode with minimal constraints.");
        }
      }

      if (!reason.length) {
        reason.push("Default path applied for the chosen mode and complexity.");
      }

      return {
        finalMode,
        reason: reason.join(" "),
        action: "run",
        scheduled,
        expectedWh,
        energySavedWh,
        cacheHit: false,
        cacheKey
      };
    }

    // Generate AI summary output based on classification and decision
    function generateAISummary(prompt, classification, decision) {
      const { complexity, wordCount } = classification;
      const { finalMode, scheduled, cacheHit } = decision;

      if (!prompt.trim()) {
        return "No prompt provided. The orchestrator only performs classification and scheduling.";
      }

      if (cacheHit) {
        return "Response served from a cached result with minor local adjustments, avoiding a full model call.";
      }

      let base = "";
      if (complexity === "simple") {
        base =
          "Short, direct answer with minimal reasoning steps and a concise explanation.";
      } else if (complexity === "medium") {
        base =
          "Balanced explanation summarizing the key points, avoiding exhaustive enumeration or deep branch exploration.";
      } else {
        base =
          "Condensed treatment of a complex request, focusing on high-impact points instead of exhaustive coverage.";
      }

      if (finalMode === "eco") {
        base += " Output is kept intentionally short and low-entropy to reduce unnecessary tokens.";
      } else if (finalMode === "balanced") {
        base += " Some reasoning is elided, but core structure and clarity are preserved.";
      } else {
        base +=
          " Reasoning depth is expanded, trading extra compute for nuance and creative latitude.";
      }

      if (scheduled) {
        base +=
          " This task is scheduled for an off-peak window; here you see only a preview of the expected response.";
      }

      base += ` (Estimated prompt size: ~${wordCount} words.)`;
      return base;
    }

    // UI updates for decision
    function updateOutputUI(classification, decision) {
      outputCard.style.display = "block";
      classificationText.innerHTML = classification.explanation;

      const decisionLines = [];
      decisionLines.push(
        `Final execution mode: <strong>${decision.finalMode.toUpperCase()}</strong>.`
      );

      if (decision.cacheHit) {
        decisionLines.push(
          "This request was recognized as similar to a previous one and served from cache."
        );
      } else {
        if (decision.scheduled) {
          decisionLines.push(
            "Marked as <strong>scheduled</strong>: runs in a future batch or offâ€‘peak window."
          );
        } else {
          decisionLines.push("Executed immediately after local classification.");
        }
      }

      decisionLines.push(decision.reason);
      decisionText.innerHTML = decisionLines.join(" ");

      const delta = decision.energySavedWh;
      let badgeHTML = "";
      if (decision.cacheHit || delta > 0.001) {
        badgeHTML =
          '<span class="badge-inline badge-inline-eco"><span class="badge-inline-dot"></span>Net saving</span>';
      } else if (delta < -0.001) {
        badgeHTML =
          '<span class="badge-inline badge-inline-warn"><span class="badge-inline-dot"></span>Compute premium</span>';
      } else {
        badgeHTML =
          '<span class="badge-inline"><span class="badge-inline-dot"></span>Neutral</span>';
      }

      const savedAbs = Math.abs(delta);
      const savedStr = (savedAbs * 1000).toFixed(1); // mWh for readability
      const directionText =
        delta > 0
          ? `Saved approximately <strong>${savedStr} mWh</strong> versus naive execution.`
          : delta < 0
          ? `Spent approximately <strong>${savedStr} mWh</strong> extra to favor quality.`
          : "No significant change vs. naive execution.";

      savingsText.innerHTML = `${badgeHTML} ${directionText}`;

      // Badge for AI mode
      if (decision.finalMode === "eco") {
        aiModeBadge.className = "badge-inline badge-inline-eco";
        aiModeBadge.innerHTML =
          '<span class="badge-inline-dot"></span>ECO';
      } else if (decision.finalMode === "balanced") {
        aiModeBadge.className = "badge-inline";
        aiModeBadge.innerHTML =
          '<span class="badge-inline-dot"></span>BALANCED';
      } else {
        aiModeBadge.className = "badge-inline badge-inline-perf";
        aiModeBadge.innerHTML =
          '<span class="badge-inline-dot"></span>PERFORMANCE';
      }

      aiSummaryText.textContent = generateAISummary(
        classification.raw,
        classification,
        decision
      );
    }

    // Metrics & timeline updates
    function updateMetricsAndTimeline(classification, decision) {
      state.totalRequests += 1;
      if (decision.finalMode === "eco") {
        state.ecoRequests += 1;
      }

      // Only count positive savings for energySavedWh; negative means we allowed extra compute.
      if (decision.energySavedWh > 0) {
        state.totalEnergySavedWh += decision.energySavedWh;
      }

      // Update metrics UI
      const cappedWh = Math.min(state.totalEnergySavedWh, 0.5); // cap for bar
      const percentBar = (cappedWh / 0.5) * 100;
      energySavedValue.textContent = state.totalEnergySavedWh.toFixed(3);
      energySavedBar.style.width = `${Math.min(percentBar, 100)}%`;

      const ecoPercent =
        state.totalRequests > 0
          ? Math.round((state.ecoRequests / state.totalRequests) * 100)
          : 0;
      ecoPercentValue.textContent = ecoPercent;
      ecoPercentBar.style.width = `${ecoPercent}%`;

      let barClass = "progress-fill";
      if (ecoPercent < 30) barClass += " progress-fill-danger";
      else if (ecoPercent < 60) barClass += " progress-fill-warn";
      ecoPercentBar.className = barClass;

      // Timeline entry
      const timestamp = new Date().toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit"
      });

      const dotClass = decision.cacheHit
        ? "timeline-dot timeline-dot-cache"
        : decision.scheduled
        ? "timeline-dot timeline-dot-sched"
        : "timeline-dot timeline-dot-eco";

      const modeText = decision.cacheHit
        ? "Cache"
        : decision.scheduled
        ? "Scheduled"
        : decision.finalMode.charAt(0).toUpperCase() + decision.finalMode.slice(1);

      const item = document.createElement("div");
      item.className = "timeline-item";
      item.innerHTML = `
        <div class="${dotClass}"></div>
        <div>
          <div class="timeline-text-main">
            ${modeText} Â· ${classification.complexity.toUpperCase()} task Â· ${
        decision.cacheHit ? "Cache hit" : decision.scheduled ? "Off-peak batch" : "Immediate"
      }
          </div>
          <div class="timeline-text-meta">
            ${timestamp} Â· est. ${classification.baseWh.toFixed(
        3
      )} Wh naÃ¯ve â†’ ${decision.expectedWh.toFixed(3)} Wh orchestrated
          </div>
        </div>
      `;
      timeline.prepend(item);

      // Keep timeline to last ~12 items
      while (timeline.children.length > 12) {
        timeline.removeChild(timeline.lastChild);
      }

      // Track for simple cache heuristic
      state.timelineItems.push({
        type: "request",
        cacheKey: decision.cacheKey || classification.raw.toLowerCase().slice(0, 120),
        timestamp: Date.now()
      });
      if (state.timelineItems.length > 100) {
        state.timelineItems.shift();
      }
    }

    // Main run handler
    runButton.addEventListener("click", () => {
      const prompt = promptInput.value || "";
      const usage = aiUsageSelect.value;
      if (!prompt.trim()) {
        alert("Type a prompt first â€“ this demo only simulates orchestration logic.");
        promptInput.focus();
        return;
      }

      const classification = classifyPrompt(prompt, usage);
      const decision = decideExecution(
        classification,
        state.currentMode,
        scheduleToggle.checked
      );

      updateOutputUI(classification, decision);
      updateMetricsAndTimeline(classification, decision);
    });

    // Initial hint alignment
    updateHintsForMode();

    // ===== Powerline Communication Integration =====

    // Toggle between views
    const powerSaverApp = document.querySelector('.app');
    const plcApp = document.getElementById('plcApp');
    const togglePowerSaver = document.getElementById('togglePowerSaver');
    const togglePLC = document.getElementById('togglePLC');

    togglePowerSaver.addEventListener('click', () => {
      powerSaverApp.style.display = 'grid';
      plcApp.style.display = 'none';
      togglePowerSaver.classList.add('active');
      togglePLC.classList.remove('active');
    });

    togglePLC.addEventListener('click', () => {
      powerSaverApp.style.display = 'none';
      plcApp.style.display = 'grid';
      togglePowerSaver.classList.remove('active');
      togglePLC.classList.add('active');
    });

    // Initialize PLC UI elements
    const plcStatus = document.getElementById('plcStatus');
    const plcDeviceCount = document.getElementById('plcDeviceCount');
    const plcSignalStrength = document.getElementById('plcSignalStrength');
    const plcTotalPower = document.getElementById('plcTotalPower');
    const plcDeviceList = document.getElementById('plcDeviceList');
    const plcDeviceSelect = document.getElementById('plcDeviceSelect');
    const plcCommandSelect = document.getElementById('plcCommandSelect');
    const plcCommandParams = document.getElementById('plcCommandParams');
    const plcParamValue = document.getElementById('plcParamValue');
    const plcSendCommand = document.getElementById('plcSendCommand');
    const plcCommandResult = document.getElementById('plcCommandResult');
    const plcResultText = document.getElementById('plcResultText');
    const plcCommandHistory = document.getElementById('plcCommandHistory');

    // Wait for PLC system to initialize
    let plcSystemReady = false;
    
    function initPLCUI() {
      if (typeof window.plcSystem === 'undefined') {
        plcStatus.textContent = 'Loading...';
        setTimeout(initPLCUI, 100);
        return;
      }

      plcSystemReady = true;

      // Listen for PLC events
      window.plcSystem.on('initialized', (data) => {
        plcStatus.textContent = 'Online';
        console.log('PLC System initialized:', data);
      });

      window.plcSystem.on('network-discovered', (data) => {
        console.log('Network discovered:', data);
        updatePLCDeviceList(data.devices);
        updatePLCStats();
      });

      window.plcSystem.on('telemetry-update', (data) => {
        updatePLCStats();
      });

      window.plcSystem.on('device-discovered', (data) => {
        console.log('New device discovered:', data.device);
        updatePLCDeviceList(Array.from(window.plcSystem.devices.values()));
        updatePLCStats();
      });

      window.plcSystem.on('device-offline', (data) => {
        console.log('Device offline:', data.device);
        updatePLCDeviceList(Array.from(window.plcSystem.devices.values()));
        updatePLCStats();
      });

      window.plcSystem.on('command-executed', (data) => {
        console.log('Command executed:', data);
        addCommandToHistory(data);
        
        // Show result
        plcCommandResult.style.display = 'block';
        plcResultText.innerHTML = `
          <strong>${data.result.success ? 'âœ“ Success' : 'âœ— Failed'}:</strong><br>
          ${data.result.message}
        `;
      });
    }

    function updatePLCDeviceList(devices) {
      plcDeviceList.innerHTML = '';
      plcDeviceSelect.innerHTML = '<option value="">Select a device...</option>';

      devices.forEach(device => {
        // Add to device list
        const deviceItem = document.createElement('div');
        deviceItem.className = 'timeline-item';
        deviceItem.style.cursor = 'pointer';
        
        const statusDot = device.status === 'online' ? 'timeline-dot-eco' : 'timeline-dot';
        
        deviceItem.innerHTML = `
          <div class="${statusDot}"></div>
          <div style="flex: 1;">
            <div class="timeline-text-main">
              ${device.icon} ${device.name}
            </div>
            <div class="timeline-text-meta">
              ${device.type} Â· ${device.powerLine} Â· ${device.location}
            </div>
            <div class="timeline-text-meta">
              Status: ${device.status} Â· Last seen: ${new Date(device.lastSeen).toLocaleTimeString()}
            </div>
          </div>
        `;
        
        plcDeviceList.appendChild(deviceItem);

        // Add to device select
        if (device.status === 'online') {
          const option = document.createElement('option');
          option.value = device.id;
          option.textContent = `${device.icon} ${device.name} (${device.type})`;
          plcDeviceSelect.appendChild(option);
        }
      });

      plcDeviceCount.textContent = devices.length;
    }

    function updatePLCStats() {
      if (!plcSystemReady || !window.plcSystem) return;

      const stats = window.plcSystem.getNetworkStatistics();
      plcDeviceCount.textContent = stats.totalDevices;
      plcSignalStrength.textContent = stats.averageSignalStrength;
      plcTotalPower.textContent = stats.totalPower.toFixed(1);
    }

    function addCommandToHistory(commandData) {
      const historyItem = document.createElement('div');
      historyItem.className = 'timeline-item';
      
      const device = window.plcSystem.devices.get(commandData.deviceId);
      const timestamp = new Date().toLocaleTimeString();
      
      historyItem.innerHTML = `
        <div class="${commandData.result.success ? 'timeline-dot-eco' : 'timeline-dot'}"></div>
        <div>
          <div class="timeline-text-main">
            ${commandData.command} â†’ ${device ? device.name : commandData.deviceId}
          </div>
          <div class="timeline-text-meta">
            ${timestamp} Â· ${commandData.result.message}
          </div>
        </div>
      `;
      
      plcCommandHistory.prepend(historyItem);

      // Limit history to 10 items
      while (plcCommandHistory.children.length > 10) {
        plcCommandHistory.removeChild(plcCommandHistory.lastChild);
      }
    }

    // Command select handling
    plcDeviceSelect.addEventListener('change', () => {
      updateSendCommandButton();
    });

    plcCommandSelect.addEventListener('change', () => {
      const command = plcCommandSelect.value;
      
      // Show parameter input for commands that need it
      if (command === 'set-brightness') {
        plcCommandParams.style.display = 'block';
        plcParamValue.placeholder = 'Brightness level (0-100)';
      } else {
        plcCommandParams.style.display = 'none';
      }
      
      updateSendCommandButton();
    });

    function updateSendCommandButton() {
      const hasDevice = plcDeviceSelect.value !== '';
      const hasCommand = plcCommandSelect.value !== '';
      plcSendCommand.disabled = !(hasDevice && hasCommand);
    }

    // Send command
    plcSendCommand.addEventListener('click', async () => {
      const deviceId = plcDeviceSelect.value;
      const command = plcCommandSelect.value;
      
      if (!deviceId || !command) return;

      const parameters = {};
      if (command === 'set-brightness' && plcParamValue.value) {
        parameters.level = parseInt(plcParamValue.value);
      }

      try {
        plcSendCommand.disabled = true;
        plcSendCommand.textContent = 'Sending...';
        
        await window.plcSystem.sendCommand(deviceId, command, parameters);
        
        // Reset form
        plcCommandSelect.value = '';
        plcCommandParams.style.display = 'none';
        plcParamValue.value = '';
        
      } catch (error) {
        plcCommandResult.style.display = 'block';
        plcResultText.innerHTML = `<strong>âœ— Error:</strong><br>${error.message}`;
      } finally {
        plcSendCommand.disabled = false;
        plcSendCommand.innerHTML = '<span class="icon"></span> Send Command';
        updateSendCommandButton();
      }
    });

    // Initialize PLC UI when system is ready
    initPLCUI();

    // Update stats periodically
    setInterval(() => {
      if (plcSystemReady && window.plcSystem) {
        updatePLCStats();
      }
    }, 5000);
  </script>
  
  <!-- Load Powerline Communication System -->
  <script src="/powerline-communication.js"></script>

<!-- PayPal Integration -->
<script src="/src/utils/paypal-integration.js"></script>
<script>
  // PayPal integration is available via PayPalIntegration object
  // Example: PayPalIntegration.renderButton('paypal-button-container', {
  //   amount: 100.00,
  //   description: 'Product purchase',
  //   onSuccess: (data) => console.log('Success', data),
  //   onError: (err) => console.error('Error', err)
  // });
</script>
<!-- Angel Investment Hub -->
<script src="/src/utils/angel-investment-hub.js"></script>
<!-- PayPal Donation Link: https://www.paypal.com/donate?business=BarbrickDesign@gmail.com -->
  <!-- Self-Healing Script -->
  <script src="/self-healing.js"></script>
    <!-- AI Universal Language (AUL) Support Badge -->
    <div class="aul-badge" onclick="window.open('/ai-universal-language.html', '_blank')" title="This page supports AI Universal Language - Click to learn more">
        ðŸ¤– AUL-enabled
    </div>
    <script src="/js/universal-utilities.js"></script>

    <!-- Universal Navigation - Added by Project Fixer -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof BarbrickUniversal !== 'undefined') {
                // Only add navigation if not already present
                if (!document.querySelector('.universal-header')) {
                    BarbrickUniversal.createBackButton();
                }
                
                // Add footer if not present
                if (!document.querySelector('.universal-footer')) {
                    BarbrickUniversal.createFooter();
                }
            }
        });
    </script>
</body>
</html>