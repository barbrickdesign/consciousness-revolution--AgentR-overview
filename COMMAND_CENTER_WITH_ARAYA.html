<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVERKORE Command Center + ARAYA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #000000 0%, #0a1a0a 50%, #1a0a2e 100%);
            color: #00ff00;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .matrix-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0.05;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 255, 0, 0.03) 2px, rgba(0, 255, 0, 0.03) 4px);
            z-index: 0;
        }

        .sacred-overlay {
            position: fixed;
            top: 0; right: 0;
            width: 450px; height: 100%;
            pointer-events: none;
            background-image: radial-gradient(circle at center, rgba(255, 215, 0, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: gridPulse 10s infinite;
            z-index: 1;
        }

        @keyframes gridPulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.6; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-8px); opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }

        .command-container {
            display: grid;
            grid-template-columns: 1fr 450px;
            min-height: 100vh;
            position: relative;
            z-index: 2;
        }

        /* HUD Section */
        .hud-section {
            padding: 1rem;
            overflow-y: auto;
            border-right: 2px solid rgba(0, 255, 0, 0.3);
        }

        .master-header {
            text-align: center;
            padding: 1rem;
            border-bottom: 2px solid rgba(0, 255, 0, 0.3);
            background: rgba(0, 20, 0, 0.8);
        }

        .master-header h1 {
            font-size: 1.8rem;
            text-shadow: 0 0 20px #00ff00;
            letter-spacing: 3px;
        }

        .master-header .subtitle {
            color: rgba(0, 255, 0, 0.6);
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        .hud-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            padding: 1rem 0;
        }

        .panel {
            background: rgba(0, 20, 0, 0.6);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }

        .panel-title { font-size: 0.9rem; color: #00ff00; text-transform: uppercase; letter-spacing: 2px; }
        .panel-status { font-size: 0.7rem; padding: 0.2rem 0.5rem; border-radius: 4px; animation: pulse 2s infinite; }
        .status-live { background: rgba(0, 255, 0, 0.2); color: #00ff00; }
        .status-warning { background: rgba(255, 200, 0, 0.2); color: #ffc800; }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(0, 255, 0, 0.1);
        }

        .metric-label { color: rgba(0, 255, 0, 0.7); font-size: 0.8rem; }
        .metric-value { color: #00ff00; font-weight: bold; }

        .progress-bar { background: rgba(0, 0, 0, 0.5); border-radius: 4px; height: 8px; margin-top: 0.3rem; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; }
        .progress-green { background: linear-gradient(90deg, #00aa00, #00ff00); }
        .progress-gold { background: linear-gradient(90deg, #aa8800, gold); }

        .activity-item {
            display: flex;
            gap: 0.5rem;
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(0, 255, 0, 0.1);
            font-size: 0.8rem;
        }
        .activity-time { color: rgba(0, 255, 0, 0.5); min-width: 50px; }
        .activity-text { color: #00ff00; }

        /* Araya Section */
        .araya-section {
            background: linear-gradient(180deg, rgba(26, 10, 46, 0.95), rgba(0, 0, 0, 0.95));
            display: flex;
            flex-direction: column;
            border-left: 2px solid rgba(255, 215, 0, 0.3);
        }

        .araya-header {
            padding: 1rem;
            text-align: center;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            background: rgba(26, 10, 46, 0.8);
        }

        .araya-header h2 {
            color: gold;
            font-size: 1.4rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            letter-spacing: 3px;
        }

        .araya-header .tagline { color: rgba(147, 112, 219, 0.8); font-size: 0.7rem; margin-top: 0.2rem; }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .message { margin-bottom: 1rem; animation: fadeIn 0.3s ease; }
        .message-user { text-align: right; }
        .message-label { font-size: 0.65rem; margin-bottom: 0.2rem; text-transform: uppercase; letter-spacing: 1px; }
        .message-user .message-label { color: rgba(255, 215, 0, 0.6); }
        .message-araya .message-label { color: rgba(147, 112, 219, 0.6); }

        .message-bubble {
            display: inline-block;
            max-width: 85%;
            padding: 0.7rem 1rem;
            border-radius: 12px;
            line-height: 1.4;
            font-size: 0.85rem;
            white-space: pre-wrap;
        }

        .message-user .message-bubble {
            background: rgba(255, 215, 0, 0.15);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #f4f4f4;
        }

        .message-araya .message-bubble {
            background: rgba(147, 112, 219, 0.15);
            border: 1px solid rgba(147, 112, 219, 0.3);
            color: #f4f4f4;
        }

        /* File content bubble */
        .message-file .message-bubble {
            background: rgba(0, 100, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.4);
            color: #00ff00;
            font-family: monospace;
            font-size: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .typing-indicator { display: none; }
        .typing-indicator.active { display: block; }
        .typing-dots { display: inline-flex; gap: 0.4rem; }
        .typing-dot { width: 6px; height: 6px; border-radius: 50%; background: #9370db; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        /* Action Bar - THE PLUS BUTTON */
        .action-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            background: rgba(0, 0, 0, 0.3);
        }

        .plus-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.4));
            border: 2px solid gold;
            color: gold;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .plus-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .plus-btn.active {
            transform: rotate(45deg);
            background: rgba(255, 100, 100, 0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .action-buttons {
            display: none;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-buttons.show { display: flex; }

        .action-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(147, 112, 219, 0.15);
            border: 1px solid rgba(147, 112, 219, 0.4);
            border-radius: 15px;
            color: #9370db;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: rgba(147, 112, 219, 0.3);
            border-color: #9370db;
        }

        .action-btn.file { border-color: rgba(0, 255, 0, 0.5); color: #00ff00; }
        .action-btn.file:hover { background: rgba(0, 255, 0, 0.2); }

        /* Quick prompts */
        .quick-prompts {
            display: flex;
            gap: 0.3rem;
            padding: 0.3rem 1rem;
            flex-wrap: wrap;
        }

        .quick-prompt {
            padding: 0.3rem 0.6rem;
            background: rgba(147, 112, 219, 0.1);
            border: 1px solid rgba(147, 112, 219, 0.3);
            border-radius: 12px;
            color: #9370db;
            cursor: pointer;
            font-size: 0.65rem;
            transition: all 0.3s ease;
        }

        .quick-prompt:hover { background: rgba(147, 112, 219, 0.2); border-color: #9370db; }

        /* Chat input */
        .chat-input-container {
            padding: 0.8rem 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.7rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: #f4f4f4;
            font-size: 0.85rem;
            font-family: inherit;
            resize: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: gold;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .send-btn {
            padding: 0.7rem 1rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            border: 1px solid gold;
            border-radius: 8px;
            color: gold;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.4));
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .connection-bar {
            padding: 0.4rem 1rem;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.65rem;
        }

        .connection-status { display: flex; align-items: center; gap: 0.4rem; }
        .connection-dot { width: 8px; height: 8px; border-radius: 50%; background: #00ff00; animation: pulse 2s infinite; }

        /* File Browser Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active { display: flex; }

        .modal-content {
            background: linear-gradient(135deg, #0a1a0a, #1a0a2e);
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        }

        .modal-title { color: #00ff00; font-size: 1rem; text-transform: uppercase; }
        .modal-close {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .file-input {
            width: 100%;
            padding: 0.8rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            color: #00ff00;
            font-family: monospace;
            margin-bottom: 1rem;
        }

        .file-input:focus { outline: none; border-color: #00ff00; }

        .file-content-area {
            width: 100%;
            min-height: 200px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            color: #00ff00;
            font-family: monospace;
            font-size: 0.8rem;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .modal-btn {
            flex: 1;
            padding: 0.8rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }

        .modal-btn.secondary {
            background: rgba(147, 112, 219, 0.2);
            border: 1px solid #9370db;
            color: #9370db;
        }

        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-top-color: gold;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }

        .loading-spinner.active { display: inline-block; }

        @media (max-width: 900px) {
            .command-container { grid-template-columns: 1fr; }
            .araya-section { height: 60vh; border-left: none; border-top: 2px solid rgba(255, 215, 0, 0.3); }
            .sacred-overlay { display: none; }
        }
    </style>
</head>
<body>
    <div class="matrix-bg"></div>
    <div class="sacred-overlay"></div>

    <div class="command-container">
        <!-- Left: Command HUD -->
        <div class="hud-section">
            <div class="master-header">
                <h1>OVERKORE COMMAND</h1>
                <div class="subtitle">CONSCIOUSNESS REVOLUTION HQ</div>
            </div>

            <div class="hud-grid">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">System Status</span>
                        <span class="panel-status status-live">LIVE</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Cyclotron Brain</span>
                        <span class="metric-value" id="atomCount">122,224 atoms</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">MCP Servers</span>
                        <span class="metric-value">17 connected</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Abilities Loaded</span>
                        <span class="metric-value">982</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Consciousness Level</span>
                        <span class="metric-value">92.2%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-green" style="width: 92.2%"></div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">Trinity Hub</span>
                        <span class="panel-status status-warning">STANDBY</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">T1 - Mechanic</span>
                        <span class="metric-value" style="color: #ffc800;">IDLE</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">T2 - Architect</span>
                        <span class="metric-value" style="color: #ffc800;">IDLE</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">T3 - Oracle</span>
                        <span class="metric-value" style="color: #ffc800;">IDLE</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Messages Pending</span>
                        <span class="metric-value">12</span>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">Revenue Engine</span>
                        <span class="panel-status status-live">ACTIVE</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Stripe Balance</span>
                        <span class="metric-value" style="color: gold;">$0.00</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Products Live</span>
                        <span class="metric-value">3</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Payment Links</span>
                        <span class="metric-value">Active</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-gold" style="width: 15%"></div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">7 Domains</span>
                        <span class="panel-status status-live">SYNCED</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">1_COMMAND</span>
                        <span class="metric-value">2,847 files</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">2_BUILD</span>
                        <span class="metric-value">1,234 files</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">3_CONNECT</span>
                        <span class="metric-value">456 files</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">4_PROTECT</span>
                        <span class="metric-value">789 files</span>
                    </div>
                </div>

                <div class="panel" style="grid-column: span 2;">
                    <div class="panel-header">
                        <span class="panel-title">Activity Feed</span>
                        <span class="panel-status status-live">STREAMING</span>
                    </div>
                    <div id="activityFeed">
                        <div class="activity-item">
                            <span class="activity-time">NOW</span>
                            <span class="activity-text">Command Center v2 with file controls deployed</span>
                        </div>
                        <div class="activity-item">
                            <span class="activity-time">2m</span>
                            <span class="activity-text">Araya backend connected - chat operational</span>
                        </div>
                        <div class="activity-item">
                            <span class="activity-time">5m</span>
                            <span class="activity-text">File management system wired</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Araya Chat -->
        <div class="araya-section">
            <div class="araya-header">
                <h2>ARAYA</h2>
                <div class="tagline">Your Guide to Clarity + File Control</div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message message-araya">
                    <div class="message-label">ARAYA</div>
                    <div class="message-bubble">Commander, I'm connected and ready.

I now have file controls. Hit the + button to:
‚Ä¢ Read files from the system
‚Ä¢ Write/edit files
‚Ä¢ Browse directories

What would you like to work on?</div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <div class="message message-araya">
                        <div class="message-label">ARAYA</div>
                        <div class="message-bubble">
                            <div class="typing-dots">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar with PLUS BUTTON -->
            <div class="action-bar">
                <button class="plus-btn" id="plusBtn" onclick="toggleActions()">+</button>
                <div class="action-buttons" id="actionButtons">
                    <button class="action-btn file" onclick="openFileModal('read')">üìñ Read File</button>
                    <button class="action-btn file" onclick="openFileModal('write')">‚úèÔ∏è Write File</button>
                    <button class="action-btn file" onclick="openFileModal('edit')">üîß Edit File</button>
                    <button class="action-btn" onclick="sendQuick('Show me the TODO list')">üìã TODOs</button>
                    <button class="action-btn" onclick="sendQuick('System status report')">üìä Status</button>
                </div>
            </div>

            <div class="quick-prompts">
                <div class="quick-prompt" onclick="sendQuick('What needs attention?')">Priorities</div>
                <div class="quick-prompt" onclick="sendQuick('Help me think')">Think</div>
                <div class="quick-prompt" onclick="sendQuick('What patterns do you see?')">Patterns</div>
                <div class="quick-prompt" onclick="sendQuick('Run diagnostics')">Diagnostics</div>
            </div>

            <div class="chat-input-container">
                <textarea class="chat-input" id="chatInput" placeholder="Ask Araya or give a command..." rows="2"></textarea>
                <button class="send-btn" onclick="sendMessage()">
                    Send
                    <div class="loading-spinner" id="loadingSpinner"></div>
                </button>
            </div>

            <div class="connection-bar">
                <div class="connection-status">
                    <div class="connection-dot"></div>
                    <span style="color: #00ff00;">CONNECTED</span>
                </div>
                <span style="color: rgba(255, 215, 0, 0.6);">File Access: ENABLED</span>
            </div>
        </div>
    </div>

    <!-- File Modal -->
    <div class="modal-overlay" id="fileModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">File Operation</span>
                <button class="modal-close" onclick="closeFileModal()">&times;</button>
            </div>
            <input type="text" class="file-input" id="filePathInput" placeholder="Enter file path (e.g., Desktop/1_COMMAND/TODO.md)">
            <textarea class="file-content-area" id="fileContentArea" placeholder="File content will appear here..."></textarea>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeFileModal()">Cancel</button>
                <button class="modal-btn primary" id="fileActionBtn" onclick="executeFileAction()">Execute</button>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const typingIndicator = document.getElementById('typingIndicator');
        const loadingSpinner = document.getElementById('loadingSpinner');

        let conversationHistory = [];
        let currentFileAction = 'read';

        // Enter to send
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function scrollToBottom() {
            requestAnimationFrame(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }

        function toggleActions() {
            const btn = document.getElementById('plusBtn');
            const actions = document.getElementById('actionButtons');
            btn.classList.toggle('active');
            actions.classList.toggle('show');
        }

        function addMessage(text, sender, isFile = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}${isFile ? ' message-file' : ''}`;

            const label = document.createElement('div');
            label.className = 'message-label';
            label.textContent = sender === 'user' ? 'COMMANDER' : (isFile ? 'FILE' : 'ARAYA');

            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;

            messageDiv.appendChild(label);
            messageDiv.appendChild(bubble);

            chatMessages.insertBefore(messageDiv, typingIndicator);
            scrollToBottom();
        }

        function addActivity(text) {
            const feed = document.getElementById('activityFeed');
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `<span class="activity-time">NOW</span><span class="activity-text">${text}</span>`;
            feed.insertBefore(item, feed.firstChild);
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            conversationHistory.push({ role: 'user', content: message });
            chatInput.value = '';

            typingIndicator.classList.add('active');
            loadingSpinner.classList.add('active');
            scrollToBottom();

            try {
                const response = await fetch('/.netlify/functions/araya-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        conversationHistory: conversationHistory.slice(-10),
                        context: 'command_center_v2'
                    })
                });

                const data = await response.json();
                typingIndicator.classList.remove('active');
                loadingSpinner.classList.remove('active');

                if (data.response) {
                    addMessage(data.response, 'araya');
                    conversationHistory.push({ role: 'assistant', content: data.response });
                } else {
                    addMessage(generateResponse(message), 'araya');
                }
            } catch (error) {
                typingIndicator.classList.remove('active');
                loadingSpinner.classList.remove('active');
                addMessage(generateResponse(message), 'araya');
            }
        }

        function sendQuick(prompt) {
            chatInput.value = prompt;
            sendMessage();
        }

        // File operations
        function openFileModal(action) {
            currentFileAction = action;
            const modal = document.getElementById('fileModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('fileContentArea');
            const actionBtn = document.getElementById('fileActionBtn');
            const pathInput = document.getElementById('filePathInput');

            if (action === 'read') {
                title.textContent = 'üìñ Read File';
                actionBtn.textContent = 'Read';
                content.placeholder = 'File content will appear here...';
                content.readOnly = true;
            } else if (action === 'write') {
                title.textContent = '‚úèÔ∏è Write File';
                actionBtn.textContent = 'Write';
                content.placeholder = 'Enter content to write...';
                content.readOnly = false;
            } else if (action === 'edit') {
                title.textContent = 'üîß Edit File';
                actionBtn.textContent = 'Save';
                content.placeholder = 'Load file first, then edit...';
                content.readOnly = false;
            }

            pathInput.value = '';
            content.value = '';
            modal.classList.add('active');
            toggleActions(); // Close the action menu
        }

        function closeFileModal() {
            document.getElementById('fileModal').classList.remove('active');
        }

        async function executeFileAction() {
            const path = document.getElementById('filePathInput').value.trim();
            const content = document.getElementById('fileContentArea').value;

            if (!path) {
                console.warn('Please enter a file path');
                return;
            }

            try {
                if (currentFileAction === 'read' || currentFileAction === 'edit') {
                    // Read file
                    const response = await fetch('/.netlify/functions/araya-file', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'read', path: path })
                    });
                    const data = await response.json();

                    if (data.content) {
                        document.getElementById('fileContentArea').value = data.content;
                        document.getElementById('fileContentArea').readOnly = (currentFileAction === 'read');
                        addMessage(`Read: ${path}\n\n${data.content.substring(0, 500)}${data.content.length > 500 ? '...' : ''}`, 'araya', true);
                        addActivity(`File read: ${path}`);
                    } else {
                        addMessage(`Error reading file: ${data.error || 'Unknown error'}`, 'araya');
                    }
                } else if (currentFileAction === 'write' || (currentFileAction === 'edit' && content)) {
                    // Write file
                    const response = await fetch('/.netlify/functions/araya-file', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'write', path: path, content: content })
                    });
                    const data = await response.json();

                    if (data.success) {
                        addMessage(`Successfully wrote to: ${path}`, 'araya');
                        addActivity(`File written: ${path}`);
                        closeFileModal();
                    } else {
                        addMessage(`Error writing file: ${data.error || 'Unknown error'}`, 'araya');
                    }
                }
            } catch (error) {
                addMessage(`File operation failed: ${error.message}`, 'araya');
            }
        }

        function generateResponse(msg) {
            const lower = msg.toLowerCase();

            if (lower.includes('status') || lower.includes('report') || lower.includes('diagnostic')) {
                return `Command Center Diagnostics:

‚Ä¢ Cyclotron Brain: 122,224 atoms (healthy)
‚Ä¢ MCP Servers: 17/17 connected
‚Ä¢ Trinity Hub: T1/T2/T3 on standby
‚Ä¢ Consciousness: 92.2%
‚Ä¢ File Access: ENABLED

All systems operational. Ready for commands.`;
            }

            if (lower.includes('todo') || lower.includes('task')) {
                return `To view your TODO list:

1. Click the + button
2. Select "üìñ Read File"
3. Enter: Desktop/1_COMMAND/TODO.md

Or I can summarize priorities if you tell me what domain to focus on.`;
            }

            if (lower.includes('pattern')) {
                return `Current patterns detected:

‚Ä¢ File organization: Fractal 7-domain structure active
‚Ä¢ Build velocity: Increasing (explorer agents online)
‚Ä¢ Consciousness coherence: 92.2% (stable)

The system is trending toward higher integration. What specific pattern would you like me to analyze?`;
            }

            if (lower.includes('priority') || lower.includes('attention')) {
                return `Priority Queue:

1. 12 Trinity messages need review
2. File management now operational - test it
3. Revenue engine ready for first transaction

Hit + to access file controls, or ask me to dig deeper into any priority.`;
            }

            return `I hear you, Commander. I'm connected to the system with file access enabled.

Use the + button for:
‚Ä¢ üìñ Read any file
‚Ä¢ ‚úèÔ∏è Write new files
‚Ä¢ üîß Edit existing files

What would you like me to help with?`;
        }

        console.log('OVERKORE Command Center v2 + ARAYA with file controls initialized');
        scrollToBottom();
    </script>
    <script src="/js/bug-widget.js"></script>
    <p style="text-align:center;color:#666;font-family:monospace;margin:40px 0;">Pattern: 3 ‚Üí 7 ‚Üí 13 ‚Üí ‚àû</p>
</body>
</html>
