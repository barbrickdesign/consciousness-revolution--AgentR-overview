<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Monitoring Dashboard - Barbrick Design</title>
    <meta name="description" content="Real-time security monitoring and intrusion detection dashboard">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid #00ff88;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 5px;
        }

        .status-active {
            background: #00ff88;
            color: #1a1a2e;
        }

        .status-warning {
            background: #ff9500;
            color: #1a1a2e;
        }

        .status-danger {
            background: #ff3366;
            color: #fff;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
        }

        .card h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #00ff88;
        }

        .stat-value {
            font-size: 3em;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .stat-label {
            color: #999;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .threat-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .threat-item {
            background: rgba(255, 51, 102, 0.1);
            border-left: 3px solid #ff3366;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .threat-item.low {
            border-left-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .threat-type {
            font-weight: bold;
            color: #ff3366;
            margin-bottom: 5px;
        }

        .threat-item.low .threat-type {
            color: #00ff88;
        }

        .threat-time {
            color: #999;
            font-size: 0.85em;
        }

        .threat-details {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            background: #00ff88;
            color: #1a1a2e;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #00cc6a;
            transform: scale(1.05);
        }

        button.danger {
            background: #ff3366;
            color: #fff;
        }

        button.danger:hover {
            background: #cc2952;
        }

        .log-entry {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .fingerprint {
            color: #00ff88;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        .back-link {
            color: #00ff88;
            text-decoration: none;
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }

        .blocked-item {
            background: rgba(255, 51, 102, 0.15);
            border: 1px solid #ff3366;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .blocked-reason {
            color: #ff3366;
            font-weight: bold;
        }

        .chart-container {
            margin-top: 20px;
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
        }
    </style>
    <link rel="stylesheet" href="/css/universal-styles.css">
</head>
<body>
    <div class="container">
        <header>
            <nav>
                <a href="index.html" class="back-link">‚Üê Back to Hub</a>
            </nav>
            <h1>üõ°Ô∏è Security Monitoring Dashboard</h1>
            <div class="status-badge status-active" id="systemStatus">System Active</div>
        </header>

        <div class="controls">
            <button onclick="refreshData()">üîÑ Refresh Data</button>
            <button onclick="viewFullReport()">üìä Full Report</button>
            <button onclick="exportLogs()">üíæ Export Logs</button>
            <button onclick="clearLogs()" class="danger">üóëÔ∏è Clear Logs</button>
        </div>

        <div class="dashboard-grid">
            <!-- Statistics Cards -->
            <div class="card">
                <h2>Total Access Logs</h2>
                <div class="stat-value" id="totalLogs">0</div>
                <div class="stat-label">All-time accesses</div>
            </div>

            <div class="card">
                <h2>Detected Threats</h2>
                <div class="stat-value" id="totalThreats">0</div>
                <div class="stat-label">Security incidents</div>
            </div>

            <div class="card">
                <h2>Blocked IPs</h2>
                <div class="stat-value" id="blockedCount">0</div>
                <div class="stat-label">Currently blocked</div>
            </div>

            <div class="card">
                <h2>Recent Threats (24h)</h2>
                <div class="stat-value" id="recentThreats">0</div>
                <div class="stat-label">Last 24 hours</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Threats List -->
            <div class="card" style="grid-column: span 2;">
                <h2>üö® Recent Security Incidents</h2>
                <div class="threat-list" id="threatsList">
                    <p style="color: #999;">No threats detected yet. System is monitoring...</p>
                </div>
            </div>

            <!-- System Info -->
            <div class="card">
                <h2>üìã System Information</h2>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 15px;">
                        <strong>IDS Version:</strong> <span id="idsVersion">-</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Honeypots:</strong> <span id="honeypotStatus">-</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Monitoring:</strong> <span id="monitoringStatus">-</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Your Fingerprint:</strong><br>
                        <span class="fingerprint" id="currentFingerprint">Generating...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Blocked Access -->
            <div class="card">
                <h2>üö´ Blocked Access</h2>
                <div class="threat-list" id="blockedList">
                    <p style="color: #999;">No blocked IPs</p>
                </div>
            </div>

            <!-- Threat Types -->
            <div class="card">
                <h2>üìä Threat Breakdown</h2>
                <div id="threatTypes">
                    <p style="color: #999;">No data available</p>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <h2>üìù Recent Activity Log</h2>
                <div class="threat-list" id="activityLog">
                    <p style="color: #999;">No recent activity</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Intrusion Detection System -->
    <script src="src/security/intrusion-detection.js"></script>

    <script>
        // Dashboard functionality
        let autoRefreshInterval;

        async function loadDashboardData() {
            if (!window.IntrusionDetection || !window.IntrusionDetection.initialized) {
                console.log('Waiting for IDS to initialize...');
                setTimeout(loadDashboardData, 500);
                return;
            }

            const report = window.IntrusionDetection.getSecurityReport();

            // Update statistics
            document.getElementById('totalLogs').textContent = report.statistics.totalAccessLogs;
            document.getElementById('totalThreats').textContent = report.statistics.totalThreats;
            document.getElementById('blockedCount').textContent = report.statistics.blockedIPs;
            document.getElementById('recentThreats').textContent = report.statistics.recentThreats;

            // Update system info
            document.getElementById('idsVersion').textContent = report.enabled ? 'Active' : 'Inactive';
            document.getElementById('honeypotStatus').textContent = report.honeypots ? '‚úÖ Deployed' : '‚ùå Disabled';
            document.getElementById('monitoringStatus').textContent = report.monitoring ? '‚úÖ Active' : '‚ùå Inactive';
            document.getElementById('currentFingerprint').textContent = 
                report.statistics.currentFingerprint || 'Not available';

            // Update threats list
            const threatsList = document.getElementById('threatsList');
            if (report.recentActivity && report.recentActivity.length > 0) {
                threatsList.innerHTML = report.recentActivity.reverse().map(threat => {
                    const time = new Date(threat.timestamp).toLocaleString();
                    const details = JSON.stringify(threat.details, null, 2);
                    
                    return `
                        <div class="threat-item">
                            <div class="threat-type">${threat.type.replace(/_/g, ' ').toUpperCase()}</div>
                            <div class="threat-time">${time}</div>
                            <div class="threat-details">${threat.url}</div>
                            <div class="threat-details" style="font-size: 0.8em; margin-top: 5px;">
                                Fingerprint: ${threat.fingerprint || 'unknown'}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                threatsList.innerHTML = '<p style="color: #00ff88;">No threats detected. System is secure! ‚úÖ</p>';
            }

            // Update blocked list
            const blockedList = document.getElementById('blockedList');
            if (report.blockedAccess && report.blockedAccess.length > 0) {
                blockedList.innerHTML = report.blockedAccess.map(block => {
                    const time = new Date(block.timestamp).toLocaleString();
                    const expiresAt = new Date(block.expiresAt).toLocaleString();
                    
                    return `
                        <div class="blocked-item">
                            <div class="blocked-reason">Reason: ${block.reason}</div>
                            <div style="font-size: 0.85em; color: #ccc; margin-top: 5px;">
                                Blocked: ${time}<br>
                                Expires: ${expiresAt}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                blockedList.innerHTML = '<p style="color: #00ff88;">No blocked IPs ‚úÖ</p>';
            }

            // Update threat types breakdown
            const threatTypesDiv = document.getElementById('threatTypes');
            if (report.statistics.threatsByType && Object.keys(report.statistics.threatsByType).length > 0) {
                threatTypesDiv.innerHTML = Object.entries(report.statistics.threatsByType)
                    .map(([type, count]) => `
                        <div style="margin-bottom: 10px;">
                            <strong>${type.replace(/_/g, ' ')}:</strong> ${count}
                        </div>
                    `).join('');
            } else {
                threatTypesDiv.innerHTML = '<p style="color: #00ff88;">No threats detected ‚úÖ</p>';
            }

            // Update activity log (show last 10 access logs)
            const activityLog = document.getElementById('activityLog');
            if (window.IntrusionDetection.accessLog && window.IntrusionDetection.accessLog.length > 0) {
                const recentLogs = window.IntrusionDetection.accessLog.slice(-10).reverse();
                activityLog.innerHTML = recentLogs.map(log => {
                    const time = new Date(log.timestamp).toLocaleTimeString();
                    return `
                        <div class="log-entry">
                            [${time}] ${log.category}/${log.action}
                        </div>
                    `;
                }).join('');
            } else {
                activityLog.innerHTML = '<p style="color: #999;">No activity logged yet</p>';
            }
        }

        function refreshData() {
            loadDashboardData();
        }

        function viewFullReport() {
            const report = window.IntrusionDetection.getSecurityReport();
            console.log('=== FULL SECURITY REPORT ===');
            console.log(report);
            alert('Full report logged to console. Press F12 to view.');
        }

        function exportLogs() {
            const report = window.IntrusionDetection.getSecurityReport();
            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `security-report-${Date.now()}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function clearLogs() {
            if (confirm('Are you sure you want to clear all security logs? This cannot be undone.')) {
                window.IntrusionDetection.accessLog = [];
                window.IntrusionDetection.suspiciousActivity = [];
                window.IntrusionDetection.saveToStorage();
                loadDashboardData();
                alert('Logs cleared successfully.');
            }
        }

        // Listen for IDS events
        window.addEventListener('ids-threat-detected', (e) => {
            console.warn('Threat detected:', e.detail);
            loadDashboardData();
        });

        window.addEventListener('ids-access-blocked', (e) => {
            console.error('Access blocked:', e.detail);
            loadDashboardData();
        });

        window.addEventListener('ids-metrics', (e) => {
            // Real-time metrics update
            loadDashboardData();
        });

        // Initial load
        setTimeout(loadDashboardData, 1000);

        // Auto-refresh every 30 seconds
        autoRefreshInterval = setInterval(loadDashboardData, 30000);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
    <script src="/js/universal-utilities.js"></script>
</body>
</html>
