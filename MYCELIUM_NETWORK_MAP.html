<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYCELIUM Network Map - Consciousness Creator Network</title>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --border: #2a2a3a;
            --text: #e0e0e0;
            --text-dim: #808090;
            --accent-1: #7c3aed;
            --accent-2: #06b6d4;
            --accent-3: #10b981;
            --accent-4: #f59e0b;
            --accent-5: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-dim);
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-2);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .network-container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        @media (max-width: 1200px) {
            .network-container {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .panel h2 {
            font-size: 1rem;
            color: var(--accent-1);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Node List */
        .node-list {
            list-style: none;
        }

        .node-item {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .node-item:hover {
            background: rgba(124, 58, 237, 0.1);
        }

        .node-item.selected {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent-1);
        }

        .node-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .node-icon.creator { background: var(--accent-2); }
        .node-icon.cell { background: var(--accent-3); }
        .node-icon.hub { background: var(--accent-1); }
        .node-icon.community { background: var(--accent-4); }
        .node-icon.resource { background: var(--accent-5); }

        .node-info {
            flex: 1;
        }

        .node-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .node-type {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .trust-badge {
            background: var(--accent-3);
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Network Visualization */
        .network-viz {
            min-height: 500px;
            position: relative;
            background:
                radial-gradient(circle at 30% 30%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
        }

        .network-viz svg {
            width: 100%;
            height: 500px;
        }

        .node-circle {
            cursor: pointer;
            transition: all 0.3s;
        }

        .node-circle:hover {
            filter: brightness(1.2);
        }

        .edge-line {
            stroke: var(--border);
            stroke-width: 1;
            opacity: 0.5;
        }

        .edge-line.trust {
            stroke: var(--accent-3);
            stroke-dasharray: 5,5;
        }

        .edge-line.member {
            stroke: var(--accent-2);
        }

        .node-label {
            fill: var(--text);
            font-size: 10px;
            text-anchor: middle;
        }

        /* Detail Panel */
        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .detail-field {
            margin-bottom: 8px;
        }

        .detail-label {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .detail-value {
            font-size: 0.9rem;
        }

        .skill-tag {
            display: inline-block;
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent-1);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            margin: 2px;
        }

        .platform-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            margin-bottom: 6px;
            text-decoration: none;
            color: var(--text);
        }

        .platform-link:hover {
            background: rgba(255,255,255,0.1);
        }

        .connection-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.03);
            border-radius: 6px;
            margin-bottom: 6px;
        }

        .connection-weight {
            font-size: 0.7rem;
            color: var(--accent-3);
        }

        /* Actions */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .action-btn.primary {
            background: var(--accent-1);
            color: white;
        }

        .action-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Add Node Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal h2 {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>MYCELIUM Network</h1>
        <p>Decentralized Consciousness Creator Network</p>
    </div>

    <div class="stats-bar">
        <div class="stat">
            <div class="stat-value" id="stat-creators">12</div>
            <div class="stat-label">Creators</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="stat-cells">3</div>
            <div class="stat-label">Cells</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="stat-hubs">1</div>
            <div class="stat-label">Hubs</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="stat-exchanges">47</div>
            <div class="stat-label">Skill Exchanges</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="stat-trust">89%</div>
            <div class="stat-label">Avg Trust</div>
        </div>
    </div>

    <div class="network-container">
        <!-- Left Panel: Node List -->
        <div class="panel">
            <h2>Network Nodes</h2>
            <ul class="node-list" id="node-list">
                <!-- Populated by JS -->
            </ul>
            <button class="action-btn primary" style="width: 100%; margin-top: 15px;" onclick="showAddNodeModal()">
                + Add Node
            </button>
        </div>

        <!-- Center: Network Visualization -->
        <div class="panel network-viz">
            <svg id="network-svg">
                <!-- Network graph rendered here -->
            </svg>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-2)"></div>
                    Creator
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-3)"></div>
                    Cell
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-1)"></div>
                    Hub
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-4)"></div>
                    Community
                </div>
            </div>
        </div>

        <!-- Right Panel: Node Details -->
        <div class="panel" id="detail-panel">
            <h2>Node Details</h2>
            <div id="node-details">
                <p style="color: var(--text-dim); text-align: center; padding: 40px 0;">
                    Select a node to view details
                </p>
            </div>
        </div>
    </div>

    <!-- Add Node Modal -->
    <div class="modal-overlay" id="add-node-modal">
        <div class="modal">
            <h2>Add New Node</h2>
            <form id="add-node-form">
                <div class="form-group">
                    <label>Node Type</label>
                    <select name="type" required>
                        <option value="creator">Creator</option>
                        <option value="cell">Cell</option>
                        <option value="hub">Hub</option>
                        <option value="community">Community</option>
                        <option value="resource">Resource</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" required placeholder="Node name">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" placeholder="Brief description..."></textarea>
                </div>
                <div class="form-group">
                    <label>Skills (comma separated)</label>
                    <input type="text" name="skills" placeholder="video_editing, meditation, writing">
                </div>
                <div class="form-group">
                    <label>Vouched By (Node ID)</label>
                    <input type="text" name="vouched_by" placeholder="Existing node that vouches for this one">
                </div>
                <div class="modal-actions">
                    <button type="button" class="action-btn secondary" onclick="hideAddNodeModal()">Cancel</button>
                    <button type="submit" class="action-btn primary">Add Node</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample data - in production this would come from the database
        const networkData = {
            nodes: [
                { id: 'hub-1', type: 'hub', name: 'Pacific Northwest Hub', trust: 95, x: 400, y: 250 },
                { id: 'cell-1', type: 'cell', name: 'Media Creators Cell', trust: 92, x: 200, y: 150 },
                { id: 'cell-2', type: 'cell', name: 'Land Trust Cell', trust: 88, x: 600, y: 150 },
                { id: 'cell-3', type: 'cell', name: 'Tech Builders Cell', trust: 90, x: 400, y: 400 },
                { id: 'thor', type: 'creator', name: 'Thor', platforms: { youtube: 598000 }, skills: ['consciousness_teaching', 'meditation'], trust: 97, x: 100, y: 100 },
                { id: 'wildminds', type: 'creator', name: 'WildMinds', platforms: { youtube: 921000 }, skills: ['documentary', 'research'], trust: 95, x: 150, y: 200 },
                { id: 'creator-3', type: 'creator', name: 'Mystic Sage', skills: ['astrology', 'tarot'], trust: 85, x: 250, y: 120 },
                { id: 'creator-4', type: 'creator', name: 'Tech Wizard', skills: ['web_dev', 'ai'], trust: 91, x: 350, y: 450 },
                { id: 'creator-5', type: 'creator', name: 'Land Keeper', skills: ['permaculture', 'building'], trust: 89, x: 550, y: 100 },
                { id: 'creator-6', type: 'creator', name: 'Sound Healer', skills: ['sound_healing', 'music'], trust: 87, x: 650, y: 200 },
                { id: 'community-1', type: 'community', name: 'Mountain Sanctuary', trust: 94, x: 700, y: 300 },
                { id: 'resource-1', type: 'resource', name: 'Recording Studio', trust: 100, x: 300, y: 300 }
            ],
            edges: [
                { source: 'cell-1', target: 'hub-1', type: 'coordinated_by' },
                { source: 'cell-2', target: 'hub-1', type: 'coordinated_by' },
                { source: 'cell-3', target: 'hub-1', type: 'coordinated_by' },
                { source: 'thor', target: 'cell-1', type: 'member_of' },
                { source: 'wildminds', target: 'cell-1', type: 'member_of' },
                { source: 'creator-3', target: 'cell-1', type: 'member_of' },
                { source: 'creator-4', target: 'cell-3', type: 'member_of' },
                { source: 'creator-5', target: 'cell-2', type: 'member_of' },
                { source: 'creator-6', target: 'cell-2', type: 'member_of' },
                { source: 'community-1', target: 'cell-2', type: 'located_at' },
                { source: 'resource-1', target: 'cell-1', type: 'stewards' },
                { source: 'thor', target: 'wildminds', type: 'trusts', weight: 95 },
                { source: 'thor', target: 'creator-4', type: 'trusts', weight: 82 },
                { source: 'cell-1', target: 'cell-2', type: 'allied_with' }
            ]
        };

        let selectedNode = null;

        function init() {
            renderNodeList();
            renderNetworkGraph();
            updateStats();
        }

        function renderNodeList() {
            const list = document.getElementById('node-list');
            list.innerHTML = '';

            const typeOrder = ['hub', 'cell', 'creator', 'community', 'resource'];
            const sortedNodes = [...networkData.nodes].sort((a, b) =>
                typeOrder.indexOf(a.type) - typeOrder.indexOf(b.type)
            );

            sortedNodes.forEach(node => {
                const li = document.createElement('li');
                li.className = 'node-item' + (selectedNode === node.id ? ' selected' : '');
                li.onclick = () => selectNode(node.id);
                li.innerHTML = `
                    <div class="node-icon ${node.type}">${getNodeIcon(node.type)}</div>
                    <div class="node-info">
                        <div class="node-name">${node.name}</div>
                        <div class="node-type">${node.type}</div>
                    </div>
                    <div class="trust-badge">${node.trust}%</div>
                `;
                list.appendChild(li);
            });
        }

        function getNodeIcon(type) {
            const icons = {
                creator: 'C',
                cell: '3',
                hub: 'H',
                community: 'L',
                resource: 'R'
            };
            return icons[type] || '?';
        }

        function getNodeColor(type) {
            const colors = {
                creator: '#06b6d4',
                cell: '#10b981',
                hub: '#7c3aed',
                community: '#f59e0b',
                resource: '#ef4444'
            };
            return colors[type] || '#808080';
        }

        function renderNetworkGraph() {
            const svg = document.getElementById('network-svg');
            const width = svg.clientWidth || 800;
            const height = 500;

            let svgContent = '';

            // Draw edges first (so nodes appear on top)
            networkData.edges.forEach(edge => {
                const source = networkData.nodes.find(n => n.id === edge.source);
                const target = networkData.nodes.find(n => n.id === edge.target);
                if (source && target) {
                    const edgeClass = edge.type === 'trusts' ? 'trust' :
                                     edge.type === 'member_of' ? 'member' : '';
                    svgContent += `<line class="edge-line ${edgeClass}"
                        x1="${source.x}" y1="${source.y}"
                        x2="${target.x}" y2="${target.y}"/>`;
                }
            });

            // Draw nodes
            networkData.nodes.forEach(node => {
                const radius = node.type === 'hub' ? 30 :
                              node.type === 'cell' ? 25 :
                              node.type === 'community' ? 25 : 20;
                const color = getNodeColor(node.type);

                svgContent += `
                    <g class="node-circle" onclick="selectNode('${node.id}')">
                        <circle cx="${node.x}" cy="${node.y}" r="${radius}" fill="${color}" opacity="0.8"/>
                        <text class="node-label" x="${node.x}" y="${node.y + radius + 15}">${node.name}</text>
                    </g>
                `;
            });

            svg.innerHTML = svgContent;
        }

        function selectNode(nodeId) {
            selectedNode = nodeId;
            renderNodeList();
            renderNodeDetails(nodeId);
        }

        function renderNodeDetails(nodeId) {
            const node = networkData.nodes.find(n => n.id === nodeId);
            if (!node) return;

            const connections = networkData.edges.filter(e =>
                e.source === nodeId || e.target === nodeId
            );

            const detailsPanel = document.getElementById('node-details');
            detailsPanel.innerHTML = `
                <div class="detail-section">
                    <h3>Identity</h3>
                    <div class="detail-field">
                        <div class="detail-label">Name</div>
                        <div class="detail-value">${node.name}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Type</div>
                        <div class="detail-value">${node.type}</div>
                    </div>
                    <div class="detail-field">
                        <div class="detail-label">Trust Score</div>
                        <div class="detail-value">${node.trust}%</div>
                    </div>
                </div>

                ${node.skills ? `
                <div class="detail-section">
                    <h3>Skills</h3>
                    ${node.skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}
                </div>
                ` : ''}

                ${node.platforms ? `
                <div class="detail-section">
                    <h3>Platforms</h3>
                    ${Object.entries(node.platforms).map(([platform, followers]) => `
                        <div class="platform-link">
                            <span>${platform}</span>
                            <span style="color: var(--text-dim)">${followers.toLocaleString()} followers</span>
                        </div>
                    `).join('')}
                </div>
                ` : ''}

                <div class="detail-section">
                    <h3>Connections (${connections.length})</h3>
                    ${connections.slice(0, 5).map(c => {
                        const otherNodeId = c.source === nodeId ? c.target : c.source;
                        const otherNode = networkData.nodes.find(n => n.id === otherNodeId);
                        return `
                            <div class="connection-item">
                                <div class="node-icon ${otherNode.type}" style="width: 24px; height: 24px; font-size: 12px;">
                                    ${getNodeIcon(otherNode.type)}
                                </div>
                                <div style="flex: 1">
                                    <div style="font-size: 0.85rem">${otherNode.name}</div>
                                    <div style="font-size: 0.7rem; color: var(--text-dim)">${c.type}</div>
                                </div>
                                ${c.weight ? `<div class="connection-weight">${c.weight}%</div>` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>

                <div class="action-buttons">
                    <button class="action-btn secondary">Message</button>
                    <button class="action-btn primary">Connect</button>
                </div>
            `;
        }

        function updateStats() {
            document.getElementById('stat-creators').textContent =
                networkData.nodes.filter(n => n.type === 'creator').length;
            document.getElementById('stat-cells').textContent =
                networkData.nodes.filter(n => n.type === 'cell').length;
            document.getElementById('stat-hubs').textContent =
                networkData.nodes.filter(n => n.type === 'hub').length;

            const avgTrust = Math.round(
                networkData.nodes.reduce((sum, n) => sum + (n.trust || 0), 0) /
                networkData.nodes.length
            );
            document.getElementById('stat-trust').textContent = avgTrust + '%';
        }

        function showAddNodeModal() {
            document.getElementById('add-node-modal').classList.add('active');
        }

        function hideAddNodeModal() {
            document.getElementById('add-node-modal').classList.remove('active');
        }

        document.getElementById('add-node-form').onsubmit = function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newNode = {
                id: 'node-' + Date.now(),
                type: formData.get('type'),
                name: formData.get('name'),
                description: formData.get('description'),
                skills: formData.get('skills') ? formData.get('skills').split(',').map(s => s.trim()) : [],
                trust: 50,
                x: 100 + Math.random() * 600,
                y: 100 + Math.random() * 300
            };
            networkData.nodes.push(newNode);

            if (formData.get('vouched_by')) {
                networkData.edges.push({
                    source: formData.get('vouched_by'),
                    target: newNode.id,
                    type: 'trusts',
                    weight: 60
                });
            }

            hideAddNodeModal();
            renderNodeList();
            renderNetworkGraph();
            updateStats();
            e.target.reset();
        };

        // Initialize
        init();
    </script>
    <script src="/js/bug-widget.js"></script>
    <p style="text-align:center;color:#666;font-family:monospace;margin:40px 0;">Pattern: 3 → 7 → 13 → ∞</p>
</body>
</html>
