<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARAYA - 100X Builder Cockpit</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a0a2e 100%);
            color: #f4f4f4;
            min-height: 100vh;
            overflow: hidden;
        }
        .sacred-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.05;
            background-image: radial-gradient(circle at center, gold 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none; z-index: 0;
            animation: gridPulse 10s infinite;
        }
        @keyframes gridPulse { 0%, 100% { opacity: 0.03; } 50% { opacity: 0.08; } }
        .container { position: relative; z-index: 1; height: 100vh; display: flex; flex-direction: column; }
        .header {
            text-align: center; padding: 1.5rem;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            background: rgba(26, 10, 46, 0.8);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, gold, #ffd700, #ffed4e, gold);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; animation: shimmer 3s infinite; background-size: 200% 200%;
        }
        @keyframes shimmer { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        .header p { font-size: 0.9rem; color: rgba(255, 215, 0, 0.6); font-style: italic; }
        .back-button {
            position: fixed; top: 1rem; left: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px; color: gold; text-decoration: none;
            font-weight: 600; transition: all 0.3s ease; z-index: 100;
        }
        .back-button:hover { background: rgba(255, 215, 0, 0.2); }
        .api-status {
            position: fixed; top: 1rem; right: 1rem;
            padding: 0.5rem 1rem; border-radius: 8px;
            font-size: 0.8rem; z-index: 100;
        }
        .api-status.connected { background: rgba(0, 255, 0, 0.1); border: 1px solid rgba(0, 255, 0, 0.3); color: #0f0; }
        .api-status.disconnected { background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3); color: #f00; }
        .chat-container { flex: 1; display: flex; flex-direction: column; max-width: 1200px; width: 100%; margin: 0 auto; padding: 1rem; }
        .messages { flex: 1; overflow-y: auto; padding: 1rem; margin-bottom: 1rem; }
        .message { margin-bottom: 1rem; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message-user { text-align: right; }
        .message-bubble {
            display: inline-block; max-width: 70%; padding: 1rem 1.5rem;
            border-radius: 18px; line-height: 1.6; white-space: pre-wrap;
            font-family: 'Courier New', monospace; font-size: 0.9rem;
        }
        .message-user .message-bubble { background: rgba(255, 215, 0, 0.15); border: 1px solid rgba(255, 215, 0, 0.3); }
        .message-araya .message-bubble { background: rgba(147, 112, 219, 0.15); border: 1px solid rgba(147, 112, 219, 0.3); }
        .message-label { font-size: 0.75rem; color: rgba(255, 215, 0, 0.6); margin-bottom: 0.3rem; }
        .message-araya .message-label { color: rgba(147, 112, 219, 0.6); }
        .input-container {
            background: rgba(26, 10, 46, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px; padding: 1rem; display: flex; gap: 1rem;
        }
        .message-input {
            flex: 1; padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px; color: #f4f4f4;
            font-size: 1rem; resize: none; font-family: inherit;
        }
        .message-input:focus { outline: none; border-color: gold; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
        .send-button {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.3));
            border: 2px solid gold; border-radius: 8px;
            color: gold; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
        }
        .send-button:hover { background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.4)); }
        .quick-prompts { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .quick-prompt {
            padding: 0.4rem 0.8rem;
            background: rgba(147, 112, 219, 0.1);
            border: 1px solid rgba(147, 112, 219, 0.3);
            border-radius: 20px; color: #9370db;
            cursor: pointer; transition: all 0.3s ease; font-size: 0.85rem;
        }
        .quick-prompt:hover { background: rgba(147, 112, 219, 0.2); border-color: #9370db; }
        .typing-indicator { display: none; padding: 1rem; }
        .typing-indicator.active { display: block; }
        .typing-dots { display: inline-flex; gap: 0.5rem; }
        .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: #9370db; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-10px); opacity: 1; } }
        .success { color: #0f0; } .error { color: #f44; }
    </style>
</head>
<body>
    <div class="sacred-grid"></div>
    <a href="index.html" class="back-button">‚Üê Lobby</a>
    <div id="apiStatus" class="api-status disconnected">API: Checking...</div>

    <div class="container">
        <div class="header">
            <h1>ARAYA</h1>
            <p>100X Builder Cockpit - File Editing Enabled</p>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="message message-araya">
                    <div class="message-label">ARAYA</div>
                    <div class="message-bubble">Welcome to the 100X Builder Cockpit.

I can READ, WRITE, EDIT, and LIST files. Try:

üìñ "read index.html"
üìÅ "list files" or "list files in ARAYA"
‚úèÔ∏è "write test.txt: Hello World"
üîß "edit test.txt change Hello to Hi"
‚ûï "append to test.txt: More content"

What shall we build?</div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message message-araya">
                    <div class="message-label">ARAYA</div>
                    <div class="message-bubble"><div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>
                </div>
            </div>

            <div class="quick-prompts">
                <div class="quick-prompt" onclick="sendQuickPrompt('list files')">üìÅ List Files</div>
                <div class="quick-prompt" onclick="sendQuickPrompt('read index.html')">üìñ Read index.html</div>
                <div class="quick-prompt" onclick="sendQuickPrompt('write test.txt: Hello from ARAYA!')">‚úèÔ∏è Write test.txt</div>
                <div class="quick-prompt" onclick="sendQuickPrompt('list files in ARAYA')">üìÇ ARAYA folder</div>
            </div>

            <div class="input-container">
                <textarea class="message-input" id="messageInput" placeholder="Try: read, list, write, edit, append..." rows="2"></textarea>
                <button class="send-button" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        const messageInput = document.getElementById('messageInput');
        const messages = document.getElementById('messages');
        const typingIndicator = document.getElementById('typingIndicator');
        const apiStatus = document.getElementById('apiStatus');

        const API = window.location.hostname === 'localhost'
            ? 'http://localhost:5001'
            : 'https://araya-api.consciousnessrevolution.io';
        let connected = false;

        checkHealth();
        setInterval(checkHealth, 30000);

        async function checkHealth() {
            try {
                const res = await fetch(`${API}/health`);
                const data = await res.json();
                if (data.status === 'alive') {
                    connected = true;
                    apiStatus.textContent = 'API: CONNECTED ‚úì';
                    apiStatus.className = 'api-status connected';
                }
            } catch (e) {
                connected = false;
                apiStatus.textContent = 'API: OFFLINE';
                apiStatus.className = 'api-status disconnected';
            }
        }

        function detectIntent(msg) {
            const lower = msg.toLowerCase();
            const original = msg;

            // read file.ext
            const readMatch = lower.match(/read (?:file )?([a-z0-9\-\_\.\/\\]+\.[a-z]+)/i);
            if (readMatch) return {action: 'read', file: readMatch[1]};

            // list files [in dir]
            if (lower.includes('list files') || lower.includes('show files')) {
                const dirMatch = lower.match(/in ([a-z0-9\-\_\.\/\\]+)/i);
                return {action: 'list', dir: dirMatch ? dirMatch[1] : '.'};
            }

            // write file.ext: content
            const writeMatch = original.match(/(?:write|create) (?:file )?([a-z0-9\-\_\.\/\\]+\.[a-z]+)[:\s]+(.+)/is);
            if (writeMatch) return {action: 'write', file: writeMatch[1], content: writeMatch[2].trim()};

            // edit file.ext change X to Y
            const editMatch = original.match(/(?:edit|update) (?:file )?([a-z0-9\-\_\.\/\\]+\.[a-z]+)[,\s]+(?:change|replace) (.+?) (?:to|with) (.+)/is);
            if (editMatch) return {action: 'edit', file: editMatch[1], oldText: editMatch[2].trim(), newText: editMatch[3].trim()};

            // append to file.ext: content
            const appendMatch = original.match(/append (?:to )?([a-z0-9\-\_\.\/\\]+\.[a-z]+)[:\s]+(.+)/is);
            if (appendMatch) return {action: 'append', file: appendMatch[1], content: appendMatch[2].trim()};

            return null;
        }

        async function handleFile(intent) {
            try {
                let res, result, response;

                if (intent.action === 'read') {
                    res = await fetch(`${API}/read-file`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({file_path: intent.file})
                    });
                    result = await res.json();
                    if (result.success) {
                        const preview = result.content.length > 1500 ? result.content.substring(0, 1500) + '\n...(truncated)' : result.content;
                        response = `üìÑ ${intent.file}\n\n${preview}\n\n‚úÖ ${result.size} chars`;
                    } else {
                        response = `‚ùå ${result.error}`;
                    }
                }
                else if (intent.action === 'list') {
                    res = await fetch(`${API}/list-files`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({dir_path: intent.dir})
                    });
                    result = await res.json();
                    if (result.success) {
                        const list = result.files.slice(0, 40).map(f => `${f.type === 'dir' ? 'üìÅ' : 'üìÑ'} ${f.name}`).join('\n');
                        response = `üìÇ ${intent.dir}/\n\n${list}\n\n(${result.files.length} items)`;
                    } else {
                        response = `‚ùå ${result.error}`;
                    }
                }
                else if (intent.action === 'write') {
                    res = await fetch(`${API}/write-file`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({file_path: intent.file, content: intent.content})
                    });
                    result = await res.json();
                    response = result.success ? `‚úÖ Created ${intent.file} (${intent.content.length} chars)` : `‚ùå ${result.error}`;
                }
                else if (intent.action === 'edit') {
                    res = await fetch(`${API}/edit-file`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({file_path: intent.file, old_text: intent.oldText, new_text: intent.newText})
                    });
                    result = await res.json();
                    response = result.success ? `‚úÖ Edited ${intent.file}: "${intent.oldText}" ‚Üí "${intent.newText}"` : `‚ùå ${result.error}`;
                }
                else if (intent.action === 'append') {
                    res = await fetch(`${API}/append-file`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({file_path: intent.file, content: intent.content})
                    });
                    result = await res.json();
                    response = result.success ? `‚úÖ Appended to ${intent.file}` : `‚ùå ${result.error}`;
                }

                return response;
            } catch (e) {
                return `‚ùå Error: ${e.message}`;
            }
        }

        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
        });

        async function sendMessage() {
            const msg = messageInput.value.trim();
            if (!msg) return;

            addMessage(msg, 'user');
            messageInput.value = '';
            typingIndicator.classList.add('active');

            const intent = detectIntent(msg);

            if (intent && connected) {
                const response = await handleFile(intent);
                typingIndicator.classList.remove('active');
                addMessage(response, 'araya');
            } else if (intent && !connected) {
                typingIndicator.classList.remove('active');
                addMessage('‚ö†Ô∏è API offline. Start: python ARAYA_FILE_WRITER.py', 'araya');
            } else {
                setTimeout(() => {
                    typingIndicator.classList.remove('active');
                    addMessage("I understand file commands: read, list, write, edit, append. What would you like to do?", 'araya');
                }, 800);
            }
        }

        function sendQuickPrompt(prompt) { messageInput.value = prompt; sendMessage(); }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message message-${sender}`;
            div.innerHTML = `<div class="message-label">${sender === 'user' ? 'YOU' : 'ARAYA'}</div><div class="message-bubble">${escapeHtml(text)}</div>`;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function escapeHtml(text) {
            return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        console.log('üöÄ ARAYA 100X Builder Cockpit initialized');
    </script>
    <script src="/js/bug-widget.js"></script>
    <p style="text-align:center;color:#666;font-family:monospace;margin:40px 0;">Pattern: 3 ‚Üí 7 ‚Üí 13 ‚Üí ‚àû</p>
</body>
</html>
